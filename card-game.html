<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Deep Conversation Card Game</title>
  <link rel="stylesheet" href="card-game.css">
</head>
<body>
  <div class="container">
    <!-- Page 1: Setup -->
    <div id="page-setup" class="page active">
      <div class="page-header">
        <h1 class="page-title">Deep Conversation Assistant</h1>
        <p class="page-subtitle">Open hearts with cards and let care flow</p>
      </div>

      <div class="content-card">
        <h2 class="setup-title">Game Setup</h2>

        <div class="player-count-section">
          <label class="section-label">Choose number of players</label>
          <div class="count-options">
            <button class="count-btn" data-count="2" onclick="setPlayerCount(2)">2 Players</button>
            <button class="count-btn active" data-count="3" onclick="setPlayerCount(3)">3 Players</button>
            <button class="count-btn" data-count="4" onclick="setPlayerCount(4)">4 Players</button>
            <button class="count-btn" data-count="5" onclick="setPlayerCount(5)">5 Players</button>
            <button class="count-btn" data-count="6" onclick="setPlayerCount(6)">6 Players</button>
          </div>
        </div>

        <div class="player-inputs" id="player-inputs"></div>

        <button class="btn btn-primary" onclick="goToRules()">Next</button>
      </div>
    </div>

    <!-- Page 2: Rules -->
    <div id="page-rules" class="page">
      <div class="page-header">
        <h1 class="page-title">Game Guidelines</h1>
        <p class="page-subtitle">Before starting, everyone agrees to the following</p>
      </div>

      <div class="content-card">
        <div class="rule-item">
          <div class="rule-icon">&#9878;&#65039;</div>
          <div class="rule-content">
            <h3>Equal Relationship</h3>
            <p>In this game, there is no parent authority or child role; everyone is an equal participant.</p>
          </div>
        </div>

        <div class="rule-item">
          <div class="rule-icon">&#128142;</div>
          <div class="rule-content">
            <h3>Sincerity First</h3>
            <p>All participants agree to be honest and open during the conversation.</p>
          </div>
        </div>

        <div class="rule-item">
          <div class="rule-icon">&#129323;</div>
          <div class="rule-content">
            <h3>No Interruptions</h3>
            <p>No interruptions of any kind. Please listen with patience.</p>
          </div>
        </div>

        <div class="confirm-section">
          <p class="confirm-hint">Each player tap to confirm</p>
          <div class="confirm-avatars" id="confirm-avatars"></div>
        </div>

        <div class="btn-group">
          <button class="btn btn-secondary" onclick="goToSetup()">Back</button>
          <button class="btn btn-primary" id="btn-to-cards" onclick="goToCardSelect()" disabled>
            Start game after all confirm
          </button>
        </div>
      </div>
    </div>

    <!-- Page 3: Function Card Selection -->
    <div id="page-cards" class="page">
      <div class="page-header">
        <h1 class="page-title">Select Function Cards</h1>
        <p class="page-subtitle" id="card-select-hint">Please select 2 function cards</p>
      </div>

      <div class="content-card">
        <div class="selector-info">
          <div class="selector-avatar" id="selector-avatar">&#128104;</div>
          <div class="selector-name" id="selector-name">Player</div>
          <div class="selector-progress" id="selector-progress">Selected 0/2</div>
        </div>

        <div class="function-cards-grid" id="function-cards-grid"></div>

        <button class="btn btn-primary" id="btn-confirm-cards" onclick="confirmCardSelection()" disabled>
          Confirm selection
        </button>
      </div>
    </div>

    <!-- Page 4: Main Game -->
    <div id="page-game" class="page">
      <div class="players-bar" id="players-bar"></div>

      <div class="game-header">
        <div class="current-player">
          <div class="current-avatar" id="current-avatar">&#128104;</div>
          <div class="current-info">
            <h3 id="current-name">Player</h3>
            <p>Your turn to play</p>
          </div>
        </div>
        <div class="round-info">
          <div class="round-number" id="round-number">1</div>
          <div class="round-label">Round</div>
        </div>
      </div>

      <div class="hand-section">
        <div class="section-title">&#127183; Your hand (tap to select)</div>
        <div class="hand-cards" id="hand-cards"></div>
      </div>

      <div class="action-area" id="action-area" style="display: none;">
        <div class="action-title" id="action-title">Choose a card to play</div>
        <div class="question-display" id="question-display" style="display: none;">
          <div class="question-type" id="question-type">Share Card</div>
          <div class="question-text" id="question-text">Question text</div>
        </div>
        <div class="btn-group">
          <button class="btn btn-primary" id="btn-confirm" onclick="confirmPlay()" disabled>Confirm play</button>
          <button class="btn btn-accent" onclick="nextTurn()">End turn</button>
        </div>
      </div>

      <div class="ai-panel" id="ai-panel">
        <div class="ai-title">&#129302; AI Insight</div>
        <div class="ai-insight-item">
          <div class="ai-insight-label">Player emotional states</div>
          <div class="player-emotions-grid" id="player-emotions"></div>
        </div>
        <div class="ai-insight-item">
          <div class="ai-insight-label">AI notes</div>
          <div class="ai-insight-content" id="ai-insight">Waiting for the conversation to begin...</div>
        </div>
        <button class="btn btn-secondary" style="margin-top: 12px;" onclick="goToSummary()">View conversation summary</button>
      </div>

      <div class="records-panel">
        <div class="records-title">&#128221; Conversation records</div>
        <div id="records-list">
          <div class="empty-records">No records yet. Start playing!</div>
        </div>
      </div>
    </div>

    <!-- Page 5: Summary -->
    <div id="page-summary" class="page">
      <div class="page-header">
        <h1 class="page-title">Conversation Summary</h1>
        <p class="page-subtitle">AI summary for this session</p>
      </div>

      <div class="content-card">
        <div class="summary-content" id="summary-content">
          <div class="ai-loading" id="summary-loading">
            <div class="spinner"></div>
            <span>AI is generating the summary...</span>
          </div>
        </div>

        <div class="btn-group">
          <button class="btn btn-secondary" onclick="goToGame()">Back to game</button>
          <button class="btn btn-primary" onclick="restartGame()">Start new game</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Answer Modal -->
  <div class="modal-overlay" id="modal-answer">
    <div class="modal-content">
      <div class="modal-icon" id="modal-icon">&#128172;</div>
      <div class="modal-title" id="modal-title">Share Moment</div>
      <div class="modal-desc" id="modal-question">Please answer the question</div>
      <div class="voice-status" id="voice-status-answer"></div>
      <div class="voice-input-wrapper">
        <textarea class="modal-input" id="modal-input" rows="4" placeholder="Share your thoughts..."></textarea>
        <button class="voice-btn" id="voice-btn-answer" onclick="toggleVoiceInput('answer')" title="Voice input">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
            <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
          </svg>
        </button>
      </div>
      <button class="btn btn-primary" onclick="submitAnswer()">Submit</button>
    </div>
  </div>

  <!-- Evaluate Modal -->
  <div class="modal-overlay" id="modal-evaluate">
    <div class="modal-content">
      <div class="modal-icon">&#128173;</div>
      <div class="modal-title">Evaluation Moment</div>
      <div class="modal-desc">Please tell <strong id="evaluate-target-name">someone</strong> 2 strengths and 2 weaknesses</div>
      <div class="voice-status" id="voice-status-evaluate"></div>
      <div class="voice-input-wrapper">
        <textarea class="modal-input" id="evaluate-content" rows="5" placeholder="Write your evaluation..."></textarea>
        <button class="voice-btn" id="voice-btn-evaluate" onclick="toggleVoiceInput('evaluate')" title="Voice input">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
            <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
          </svg>
        </button>
      </div>
      <button class="btn btn-primary" onclick="submitEvaluate()">Submit</button>
    </div>
  </div>

  <!-- Wild Card Modal -->
  <div class="modal-overlay" id="modal-wild">
    <div class="modal-content">
      <div class="modal-icon">&#10024;</div>
      <div class="modal-title">Wild Card</div>
      <div class="modal-desc">Choose the card type to transform into</div>
      <div class="wild-card-options">
        <!-- Options rendered dynamically -->
      </div>
      <button class="btn btn-primary" id="btn-wild-confirm" onclick="confirmWildSelection()" disabled>Confirm selection</button>
    </div>
  </div>

  <!-- Player Switch Overlay -->
  <div class="turn-overlay" id="turn-overlay">
    <div class="turn-avatar" id="turn-avatar">&#128104;</div>
    <div class="turn-text" id="turn-text">It is Player's turn</div>
    <div class="turn-hint">Please pass the device to this player</div>
  </div>

  <script src="card-game.js"></script>
</body>
</html>
