<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>深度对话卡牌游戏</title>
  <link rel="stylesheet" href="card-game.css">
</head>
<body>
  <div class="container">
    <!-- 页面1: 设置页 -->
    <div id="page-setup" class="page active">
      <div class="page-header">
        <h1 class="page-title">深度对话助手</h1>
        <p class="page-subtitle">用卡牌打开心扉，让爱流动</p>
      </div>
      
      <div class="content-card">
        <h2 class="setup-title">游戏设置</h2>
        
        <div class="player-count-section">
          <label class="section-label">选择玩家人数</label>
          <div class="count-options">
            <button class="count-btn" onclick="setPlayerCount(2)">2人</button>
            <button class="count-btn active" onclick="setPlayerCount(3)">3人</button>
            <button class="count-btn" onclick="setPlayerCount(4)">4人</button>
            <button class="count-btn" onclick="setPlayerCount(5)">5人</button>
            <button class="count-btn" onclick="setPlayerCount(6)">6人</button>
          </div>
        </div>
        
        <div class="player-inputs" id="player-inputs"></div>
        
        <button class="btn btn-primary" onclick="goToRules()">下一步</button>
      </div>
    </div>
    
    <!-- 页面2: 入游须知 -->
    <div id="page-rules" class="page">
      <div class="page-header">
        <h1 class="page-title">入游须知</h1>
        <p class="page-subtitle">开始前，请全员确认以下共识</p>
      </div>
      
      <div class="content-card">
        <div class="rule-item">
          <div class="rule-icon">&#9878;&#65039;</div>
          <div class="rule-content">
            <h3>关系平等</h3>
            <p>在游戏中，没有"父母权威"或"子女身份"，每个人都是平等的对话者。</p>
          </div>
        </div>
        
        <div class="rule-item">
          <div class="rule-icon">&#128142;</div>
          <div class="rule-content">
            <h3>真诚前提</h3>
            <p>所有参与者都默认：希望通过这次游戏，进行一次深入而真实的交流。</p>
          </div>
        </div>
        
        <div class="rule-item">
          <div class="rule-icon">&#129323;</div>
          <div class="rule-content">
            <h3>绝对禁止打断</h3>
            <p>游戏中任何形式的打断发言都被禁止，请耐心倾听。</p>
          </div>
        </div>
        
        <div class="confirm-section">
          <p class="confirm-hint">请每位玩家依次点击确认</p>
          <div class="confirm-avatars" id="confirm-avatars"></div>
        </div>
        
        <div class="btn-group">
          <button class="btn btn-secondary" onclick="goToSetup()">返回</button>
          <button class="btn btn-primary" id="btn-to-cards" onclick="goToCardSelect()" disabled>
            全员确认后开始游戏
          </button>
        </div>
      </div>
    </div>
    
    <!-- 页面3: 功能牌选择 -->
    <div id="page-cards" class="page">
      <div class="page-header">
        <h1 class="page-title">选择功能牌</h1>
        <p class="page-subtitle" id="card-select-hint">请选择2张功能牌</p>
      </div>
      
      <div class="content-card">
        <div class="selector-info">
          <div class="selector-avatar" id="selector-avatar">&#128104;</div>
          <div class="selector-name" id="selector-name">玩家</div>
          <div class="selector-progress" id="selector-progress">已选 0/2</div>
        </div>
        
        <div class="function-cards-grid" id="function-cards-grid"></div>
        
        <button class="btn btn-primary" id="btn-confirm-cards" onclick="confirmCardSelection()" disabled>
          确认选择
        </button>
      </div>
    </div>
    
    <!-- 页面4: 游戏主界面 -->
    <div id="page-game" class="page">
      <div class="players-bar" id="players-bar"></div>
      
      <div class="game-header">
        <div class="current-player">
          <div class="current-avatar" id="current-avatar">&#128104;</div>
          <div class="current-info">
            <h3 id="current-name">玩家</h3>
            <p>轮到你出牌</p>
          </div>
        </div>
        <div class="round-info">
          <div class="round-number" id="round-number">1</div>
          <div class="round-label">当前轮次</div>
        </div>
      </div>
      
      <div class="hand-section">
        <div class="section-title">&#127183; 你的手牌（点击选择）</div>
        <div class="hand-cards" id="hand-cards"></div>
      </div>
      
      <div class="action-area" id="action-area" style="display: none;">
        <div class="action-title" id="action-title">请选择一张牌出牌</div>
        <div class="question-display" id="question-display" style="display: none;">
          <div class="question-type" id="question-type">分享牌</div>
          <div class="question-text" id="question-text">问题内容</div>
        </div>
        <div class="btn-group">
          <button class="btn btn-primary" id="btn-confirm" onclick="confirmPlay()" disabled>确认出牌</button>
          <button class="btn btn-accent" onclick="nextTurn()">结束出牌</button>
        </div>
      </div>
      
      <div class="ai-panel" id="ai-panel">
        <div class="ai-title">&#129302; AI 记录官洞察</div>
        <div class="ai-insight-item">
          <div class="ai-insight-label">各位玩家心理状态</div>
          <div class="player-emotions-grid" id="player-emotions"></div>
        </div>
        <div class="ai-insight-item">
          <div class="ai-insight-label">AI 洞察</div>
          <div class="ai-insight-content" id="ai-insight">等待对话开始...</div>
        </div>
        <button class="btn btn-secondary" style="margin-top: 12px;" onclick="goToSummary()">查看对话总结</button>
      </div>
      
      <div class="records-panel">
        <div class="records-title">&#128221; 对话记录</div>
        <div id="records-list">
          <div class="empty-records">还没有对话记录，出牌开始吧！</div>
        </div>
      </div>
    </div>
    
    <!-- 页面5: 总结页 -->
    <div id="page-summary" class="page">
      <div class="page-header">
        <h1 class="page-title">对话总结</h1>
        <p class="page-subtitle">AI 为本次对话生成的总结</p>
      </div>
      
      <div class="content-card">
        <div class="summary-content" id="summary-content">
          <div class="ai-loading" id="summary-loading">
            <div class="spinner"></div>
            <span>AI 正在生成总结...</span>
          </div>
        </div>
        
        <div class="btn-group">
          <button class="btn btn-secondary" onclick="goToGame()">返回游戏</button>
          <button class="btn btn-primary" onclick="restartGame()">开始新游戏</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- 回答弹窗 -->
  <div class="modal-overlay" id="modal-answer">
    <div class="modal-content">
      <div class="modal-icon" id="modal-icon">&#128172;</div>
      <div class="modal-title" id="modal-title">分享时刻</div>
      <div class="modal-desc" id="modal-question">请回答问题</div>
      <div class="voice-status" id="voice-status-answer"></div>
      <div class="voice-input-wrapper">
        <textarea class="modal-input" id="modal-input" rows="4" placeholder="说出你的想法..."></textarea>
        <button class="voice-btn" id="voice-btn-answer" onclick="toggleVoiceInput('answer')" title="语音输入">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
            <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
          </svg>
        </button>
      </div>
      <button class="btn btn-primary" onclick="submitAnswer()">提交</button>
    </div>
  </div>
  
  <!-- 评价弹窗 -->
  <div class="modal-overlay" id="modal-evaluate">
    <div class="modal-content">
      <div class="modal-icon">&#128173;</div>
      <div class="modal-title">评价时刻</div>
      <div class="modal-desc">请对 <strong id="evaluate-target-name">某人</strong> 说出2个优点和2个缺点</div>
      <div class="voice-status" id="voice-status-evaluate"></div>
      <div class="voice-input-wrapper">
        <textarea class="modal-input" id="evaluate-content" rows="5" placeholder="写下你的评价..."></textarea>
        <button class="voice-btn" id="voice-btn-evaluate" onclick="toggleVoiceInput('evaluate')" title="语音输入">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
            <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
          </svg>
        </button>
      </div>
      <button class="btn btn-primary" onclick="submitEvaluate()">提交</button>
    </div>
  </div>
  
  <!-- 万能牌选择弹窗 -->
  <div class="modal-overlay" id="modal-wild">
    <div class="modal-content">
      <div class="modal-icon">&#10024;</div>
      <div class="modal-title">万能牌</div>
      <div class="modal-desc">选择你想变成的牌类型</div>
      <div class="wild-card-options">
        <!-- 动态生成选项 -->
      </div>
      <button class="btn btn-primary" id="btn-wild-confirm" onclick="confirmWildSelection()" disabled>确认选择</button>
    </div>
  </div>
  
  <!-- 玩家切换动画遮罩 -->
  <div class="turn-overlay" id="turn-overlay">
    <div class="turn-avatar" id="turn-avatar">&#128104;</div>
    <div class="turn-text" id="turn-text">轮到 玩家 出牌</div>
    <div class="turn-hint">请将手机交给该玩家</div>
  </div>

  <script src="card-game.js"></script>
</body>
</html>
